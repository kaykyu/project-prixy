<div class="header">
    <div class="inner">
        <h5>Kitchen status</h5>
        <mat-slide-toggle [checked]="kitchenStatus" (change)="toggle($event)">{{kitchenStatus ? 'Open' :
            'Closed'}}</mat-slide-toggle>
    </div>
    <mat-divider [vertical]="true"></mat-divider>
    <div class="inner">
        <button mat-raised-button color="accent" (click)="generateLink()"
            [disabled]="!kitchenStatus"><mat-icon>add_business</mat-icon> Generate order link</button>
    </div>
</div>

<mat-divider></mat-divider>

<div *ngIf="orders$ | async as orders; else loading">
    <div *ngIf="orders.length > 0; else noOrders">
        <div class="card-container" *ngFor="let o of orders">
            <mat-card class="orders">
                <mat-card-header>
                    <mat-card-title>{{o.date | date: 'h:mm a, dd MMM yy'}}</mat-card-title>
                    <mat-card-subtitle>OrderID: #{{o.id | uppercase}}</mat-card-subtitle>
                    <mat-card-subtitle>Table {{o.table}}</mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                    <table mat-table [dataSource]="o.orders">
                        <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef>Item</th>
                            <td mat-cell *matCellDef="let item">{{item.name}}</td>
                        </ng-container>
                        <ng-container matColumnDef="quantity">
                            <th mat-header-cell *matHeaderCellDef>#</th>
                            <td mat-cell *matCellDef="let item">{{item.quantity}}</td>
                        </ng-container>
                        <ng-container matColumnDef="action">
                            <th mat-header-cell *matHeaderCellDef> </th>
                            <td mat-cell *matCellDef="let item">
                                <button mat-icon-button (click)="completeItem(o, item.name)"
                                    [hidden]="item.completed"><mat-icon>check</mat-icon></button>
                            </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="tableCols"></tr>
                        <tr mat-row *matRowDef="let row; columns: tableCols"></tr>
                    </table>
                </mat-card-content>

                <mat-card-footer>
                    <mat-progress-bar mode="determinate" [value]="o.progress"></mat-progress-bar>
                </mat-card-footer>
            </mat-card>
        </div>
    </div>
</div>

<ng-template #noOrders>
    <div class="center">
        There are no pending orders for the kitchen.
    </div>
</ng-template>

<ng-template #loading>
    <div class="center">
        <div>
            <mat-spinner></mat-spinner>
        </div>
        <div class="main-container">
            <h6>Loading...</h6>
        </div>
    </div>
</ng-template>

<ng-template #link>
    <h2 mat-dialog-title><a [href]="orderUrl">Order Link</a></h2>
    <mat-dialog-content>
        <div class="print" #print>
            <p>Scan QR code below to order:</p>
            <img [src]="qrCode">
            <p class="bottom">Generated by Prixy on {{timestamp | date: 'd MMM y, h:mm:ss a'}}</p>
        </div>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <button mat-fab color="primary" (click)="printLink()"><mat-icon>print</mat-icon></button>
    </mat-dialog-actions>
</ng-template>